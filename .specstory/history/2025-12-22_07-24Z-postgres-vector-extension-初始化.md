<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session bf65114a-4638-4fa8-9871-20c333efa697 (2025-12-22 07:24Z) -->

# Postgres vector extension 初始化 (2025-12-22 07:24Z)

_**User (2025-12-22 02:22Z)**_

@deploy/docker/docker-compose.yml 
如何在啟動時建立 vector extension（deploy/docker/postgres-init/01_init.sql）?


---

_**Agent (model default, mode Agent)**_



---


檢查 `deploy/docker/postgres-init/` 目錄與 `01_init.sql` 是否存在：


---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** • Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search** • Searched codebase "**/postgres-init/**/*.sql" • **1** result in **1** directory</summary>

Directory: **\home\chad\RAG-Anything-1022** (1 file)

| File |
|------|
| `deploy\docker\postgres-init\01_init.sql` |

</details>
</tool-use>

---



---


讀取現有初始化腳本內容：


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /home/chad/RAG-Anything-1022/deploy/docker/postgres-init/01_init.sql</summary>

</details>
</tool-use>

---



---


已確認 `01_init.sql` 存在，且已包含建立 vector extension 的 SQL。`docker-compose.yml` 已正確掛載初始化目錄。

說明：
1. 自動執行機制：PostgreSQL 官方映像會在首次初始化資料庫時，自動執行 `/docker-entrypoint-initdb.d` 目錄下的所有 `.sql` 和 `.sh` 檔案。
2. 當前配置：`docker-compose.yml` 已將 `./postgres-init` 掛載到容器的 `/docker-entrypoint-initdb.d`，且為唯讀。

```12:14:deploy/docker/docker-compose.yml
    volumes:
      - pg_data:/var/lib/postgresql/data
      - ./postgres-init:/docker-entrypoint-initdb.d:ro
```

```1:5:deploy/docker/postgres-init/01_init.sql
-- Initialize pgvector extension for LightRAG PGVectorStorage
-- This runs automatically on first container startup.

CREATE EXTENSION IF NOT EXISTS vector;
```

重要注意事項：
- 只在首次初始化時執行：這些腳本只在資料庫首次建立時執行（當 `pg_data` volume 為空時）。
- 如果資料庫已存在：需要手動執行或重新建立 volume。

驗證方式：
- 啟動容器後，連線到 PostgreSQL 並執行 `\dx` 查看已安裝的 extensions，應該會看到 `vector`。

需要我協助驗證或調整配置嗎？

---

_**User (2025-12-22 02:22Z)**_

rag_db=# \dx
                             List of installed extensions
  Name   | Version |   Schema   |                     Description                      
---------+---------+------------+------------------------------------------------------
 plpgsql | 1.0     | pg_catalog | PL/pgSQL procedural language
 vector  | 0.8.1   | public     | vector data type and ivfflat and hnsw access methods
(2 rows)

---

_**Agent (model default, mode Agent)**_



---


確認 `vector` extension 已成功安裝（版本 0.8.1）。這表示初始化腳本已正常執行。

從結果可見：
- `vector` extension 已安裝在 `public` schema
- 版本為 0.8.1（支援 ivfflat 和 hnsw 索引方法）
- 初始化腳本運作正常

現在可以：
1. 使用 PostgreSQL 作為 vector storage backend
2. 在 `docker-compose.yml` 中設定相關環境變數，例如：
   - `LIGHTRAG_VECTOR_STORAGE=postgres`
   - `LIGHTRAG_KV_STORAGE=postgres`
   - `LIGHTRAG_DOC_STATUS_STORAGE=postgres`

需要我協助設定這些環境變數，或進行其他驗證嗎？

---

