<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session f08c5411-c64b-48f9-9117-2b09a12fc6b9 (2025-12-01 06:01Z) -->

# Modify script to accept specified file (2025-12-01 06:01Z)

_**User (2025-12-01 06:01Z)**_

@eval/demo.py 修改成可以接受指定檔案(沒有指定時使用預設檔案)

---

_**Agent (model default, mode Agent)**_



---


修改 `eval/demo.py`，使其可接受命令列參數指定檔案，未指定時使用預設檔案。


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: eval/demo.py</summary>

</details>
</tool-use>

---



---


修改程式碼，加入命令列參數支援，可指定檔案路徑，未指定時使用預設檔案。


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **code_edit** • Edit file: eval/demo.py</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -1,2 +1,3 @@
+ import argparse
  import asyncio
  import os
```

**Chunk 2**
Lines added: 1, lines removed: 1

```diff
@@ -8,5 +9,5 @@
  
  
- async def main():
+ async def main(file_path=None):
      # 設定 API 配置
      api_key = os.getenv(&quot;LLM_BINDING_API_KEY&quot;)  # 從環境變量獲取 API 金鑰
```

</details>

</tool-use>

---



---





---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **code_edit** • Edit file: eval/demo.py</summary>

**Chunk 1**
Lines added: 3, lines removed: 1

```diff
@@ -103,6 +103,8 @@
  
      # 處理文件
+     default_file = &quot;./eval/VS Code AI 擴充套件適用比較.pdf&quot;
+     file_to_process = file_path if file_path else default_file
      await rag.process_document_complete(
-         file_path=&quot;./eval/VS Code AI 擴充套件適用比較.pdf&quot;,
+         file_path=file_to_process,
          output_dir=&quot;./output&quot;,
          parse_method=&quot;auto&quot;,
```

</details>

</tool-use>

---



---





---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **code_edit** • Edit file: eval/demo.py</summary>

**Chunk 1**
Lines added: 10, lines removed: 1

```diff
@@ -134,4 +134,13 @@
  
  if __name__ == &quot;__main__&quot;:
-     asyncio.run(main())
+     parser = argparse.ArgumentParser(description=&quot;RAGAnything 文件處理與查詢工具&quot;)
+     parser.add_argument(
+         &quot;--file&quot;,
+         &quot;-f&quot;,
+         type=str,
+         default=None,
+         help=&quot;要處理的檔案路徑（預設：./eval/VS Code AI 擴充套件適用比較.pdf）&quot;,
+     )
+     args = parser.parse_args()
+     asyncio.run(main(file_path=args.file))
  
```

</details>

</tool-use>

---



---


檢查是否有語法或 lint 錯誤：


---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `eval/demo.py`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


已修改 `eval/demo.py`，支援命令列參數指定檔案。變更如下：

1. 導入 `argparse` 模組
2. 修改 `main()` 函數，接受 `file_path` 參數
3. 在處理文件時，若未提供參數則使用預設檔案路徑
4. 在 `if __name__ == "__main__"` 區塊中加入命令列參數解析

使用方式：

```bash
# 使用預設檔案
python eval/demo.py

# 指定檔案
python eval/demo.py --file ./path/to/your/file.pdf
# 或使用簡短參數
python eval/demo.py -f ./path/to/your/file.pdf
```

未指定 `--file` 或 `-f` 時，會使用預設檔案 `./eval/VS Code AI 擴充套件適用比較.pdf`。

---

_**User (2025-12-01 06:01Z)**_

@pwsh (47-95) 

---

_**Agent (model default, mode Agent)**_



---


檢視相關程式碼，了解錯誤處理機制，並改善錯誤處理：


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: raganything/parser.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: raganything/processor.py</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: eval/demo.py</summary>

</details>
</tool-use>

---



---


在 `demo.py` 中加入錯誤處理，讓 LibreOffice 轉換失敗時能更優雅地處理：


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **code_edit** • Edit file: eval/demo.py</summary>

**Chunk 1**
Lines added: 32, lines removed: 5

```diff
@@ -105,9 +105,36 @@
      default_file = &quot;./eval/VS Code AI 擴充套件適用比較.pdf&quot;
      file_to_process = file_path if file_path else default_file
-     await rag.process_document_complete(
-         file_path=file_to_process,
-         output_dir=&quot;./output&quot;,
-         parse_method=&quot;auto&quot;,
-     )
+     
+     try:
+         await rag.process_document_complete(
+             file_path=file_to_process,
+             output_dir=&quot;./output&quot;,
+             parse_method=&quot;auto&quot;,
+         )
+     except RuntimeError as e:
+         error_msg = str(e)
+         if &quot;LibreOffice conversion failed&quot; in error_msg:
+             print(&quot;\n&quot; + &quot;=&quot; * 80)
+             print(&quot;錯誤：LibreOffice 轉換失敗&quot;)
+             print(&quot;=&quot; * 80)
+             print(f&quot;\n無法處理檔案：{file_to_process}&quot;)
+             print(&quot;\n可能的原因：&quot;)
+             print(&quot;1. LibreOffice 未安裝&quot;)
+             print(&quot;2. LibreOffice 未正確配置在系統 PATH 中&quot;)
+             print(&quot;3. 檔案格式不支援或檔案損壞&quot;)
+             print(&quot;\n解決方案：&quot;)
+             print(&quot;- Windows: 從 https://www.libreoffice.org/download/download/ 下載並安裝 LibreOffice&quot;)
+             print(&quot;- macOS: 執行 brew install --cask libreoffice&quot;)
+             print(&quot;- Ubuntu/Debian: 執行 sudo apt-get install libreoffice&quot;)
+             print(&quot;- CentOS/RHEL: 執行 sudo yum install libreoffice&quot;)
+             print(&quot;\n或者：&quot;)
+             print(&quot;- 手動將檔案轉換為 PDF 格式後再處理&quot;)
+             print(&quot;=&quot; * 80)
+         else:
+             print(f&quot;\n錯誤：{error_msg}&quot;)
+         raise
+     except Exception as e:
+         print(f&quot;\n處理檔案時發生未預期的錯誤：{e}&quot;)
+         raise
  
      # 查詢處理後的內容
```

</details>

</tool-use>

---



---





---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `eval/demo.py`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


已在 `demo.py` 中加入錯誤處理。當 LibreOffice 轉換失敗時，程式會：

1. **捕獲 RuntimeError**：特別處理 LibreOffice 轉換失敗的情況
2. **顯示清楚的錯誤訊息**：包含：
   - 無法處理的檔案路徑
   - 可能的原因
   - 各平台的安裝指令
   - 替代方案（手動轉換為 PDF）
3. **保持錯誤傳播**：仍會拋出錯誤，但會先顯示清楚的說明

當處理 Excel 或其他 Office 檔案但系統未安裝 LibreOffice 時，會顯示清楚的錯誤訊息與解決方案，而非直接崩潰。

若需更進一步處理（例如自動跳過或改用其他解析方法），可再調整。

---

